pipeline{
    agent any
	
    environment {
    	DOCKERHUB_CREDENTIALS = credentials('dockerhub')
      }

stages{
    
	    
	   stage('Pull docker image') {
    	  steps {
      		  sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
		  sh 'docker pull samarbelhadj/config-server:1.0'
     		 }
  	  }
	  
	  
	     
	 
	  
	   stage('Deployin to Kubernetes') {
     		 steps {
      		
			withKubeConfig([credentialsId: 'kubernetes', serverUrl: 'https://192.168.49.2:8443']) {
                            sh 'kubectl apply -f deploymentservice.yml'
			    sh 'kubectl get pods'
                        }

      		}
   	 }
	  
	  
	  
	  
	   

    }
  
	    
	 
   



	    
    }
	    
  
